<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gerenciador de Acessos</title>
</head>
<body>
  <h1>Gerenciador de Acessos</h1>

  <label>Token do GitHub:</label>
  <input type="password" id="token" placeholder="GitHub Token" />

  <label>Repositório (owner/repo):</label>
  <input type="text" id="repo" value="ifGarcia/githubaction" />

  <label>Branch:</label>
  <input type="text" id="branch" value="gh-pages" />

  <label>Caminho do arquivo:</label>
  <input type="text" id="filepath" value="access_control.json" />

  <button onclick="carregar()">Carregar</button>

  <script>
    document.addEventListener("DOMContentLoaded",.getElementById("token").value = savedToken;

        const res = await fetch("https://api.github.com/user", {
          headers: {
            Authorization: `Bearer ${savedToken}`,
            Accept: "application/vnd.github.v3+json"
          }
        });

        if (res.ok) {
          console.log("✅ Token válido.");
        } else {
          localStorage.removeItem("github_token");
          alert("Token inválido. Por favor, insira um novo.");
        }
      }
    });

    async function carregar() {
      const token = document.getElementById("token").value;
      const repo = document.getElementById("repo").value;
      const branch = document.getElementById("branch").value;
      const filepath = document.getElementById("filepath").value;

      localStorage.setItem("github_token", token);

      const headers = {
        Authorization: `Bearer ${token}`,
        Accept: "application/vnd.github.v3+json"
      };

      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filepath}?ref=${branch}`, { headers });
        const data = await res.json();
        const content = JSON.parse(atob(data.content));
        console.log("✅ Arquivo carregado:", content);
        alert("Arquivo carregado com sucesso!");
      } catch (err) {
        console.error("❌ Erro ao carregar arquivo:", err);
        alert("Erro ao carregar o arquivo.");
      }
    }
  </script>
</body>
</html>
